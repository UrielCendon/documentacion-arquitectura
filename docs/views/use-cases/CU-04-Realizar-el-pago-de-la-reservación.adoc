== CU-04 Realizar el pago de la reservación
[cols="25,~",options="header"]
|===
| ID | CU-04
| Nombre | Realizar el pago de la reservación
| Autor | Uriel Cendón Díaz
| Fecha de actualización | 04 de octubre de 2025
| Descripción | Se procesa el pago de una reservación mediante una pasarela de pago externa. El sistema sólo registra el estado y actualiza la reservación según la respuesta de la pasarela.
| Actor(es) | Huésped
| Disparador | Extendido por CU-02 y CU-03.
| Precondiciones | -PRE-01: Existe una reservación pendiente de pago con folio e importe.
| Flujo normal |
1.- El sistema prepara la orden de pago con el importe y la referencia, y redirige a la pasarela; registra el envío. +
2.- El huésped introduce el pago en la pasarela. +
3.- El sistema recibe y valida la respuesta de la pasarela, actualiza el estado de la reservación, registra el resultado y emite el comprobante de pago, así como regresa al caso de uso que lo extendió. (Ver FA 3.1) (Ver FA 3.2) (Ver EX 1) (Ver EX 2) (Ver EX 3) +
4.- Termina el caso de uso.
| Flujos alternos |
FA 3.1 El pago queda pendiente de autenticación. +
1.- El sistema marca la operación como en verificación y continuará al recibir confirmación de la pasarela. +
2.- Termina el caso de uso. +
FA 3.2 El huésped cancela en la pasarela. +
1.- El sistema marca el intento como cancelado por el usuario y retorna al caso de uso que lo extendió. +
2.- Termina el caso de uso.
| Excepciones |
EX 1 - La pasarela no está disponible. +
1.- El sistema informa indisponibilidad y permite reintentar; registra el incidente. +
2.- Termina el caso de uso. +
EX 2 - El pago fue rechazado. +
1.- El sistema marca la operación como rechazada, registra el motivo (cuando esté disponible) y retorna al caso de uso que la extendió. +
2.- Termina el caso de uso. +
EX 3 - Respuesta inválida de la pasarela. +
1.- El sistema detecta inconsistencia de seguridad, rechaza la operación, registra el incidente y solicita intentar más tarde. +
2.- Termina el caso de uso.
| Postcondiciones | POST-01: La reservación queda pagada.
|Reglas de negocio|
|===
